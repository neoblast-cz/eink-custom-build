{% extends "base.html" %}
{% block title_suffix %} - Settings{% endblock %}
{% block content %}
<h2>Settings</h2>
<form method="POST" class="settings-form" style="max-width: 600px;">

  <h3>Module Rotation</h3>
  <p class="hint">Add modules to rotate between them. Each module displays for its own duration before switching. If only one module is listed, it refreshes at the set interval.</p>

  <div id="rotationList">
    {% for entry in rotation %}
    <div class="rotation-entry">
      <select name="rotation_module">
        {% for name, module in modules.items() %}
        <option value="{{ name }}" {% if name == entry.module %}selected{% endif %}>
          {{ module.DISPLAY_NAME }}
        </option>
        {% endfor %}
      </select>
      <input type="number" name="rotation_duration" value="{{ entry.duration_minutes }}" min="1" max="1440" style="width: 80px;">
      <span class="hint" style="margin: 0;">min</span>
      <button type="button" class="btn-danger" onclick="this.parentElement.remove()">Remove</button>
    </div>
    {% endfor %}
  </div>

  <button type="button" class="btn-secondary" onclick="addRotationEntry()" style="margin-top: 0.5rem;">+ Add Module</button>

  <hr>

  <label for="refresh_minutes">Fallback Refresh Interval (minutes)</label>
  <input type="number" id="refresh_minutes" name="refresh_minutes"
         value="{{ config.refresh_minutes }}" min="1" max="1440">
  <p class="hint">Used when only one module is in rotation (no cycling).</p>

  <div class="form-actions">
    <button type="submit" class="btn-primary">Save</button>
    <a href="/" class="btn-secondary">Cancel</a>
  </div>
</form>

<template id="rotationTemplate">
  <div class="rotation-entry">
    <select name="rotation_module">
      {% for name, module in modules.items() %}
      <option value="{{ name }}">{{ module.DISPLAY_NAME }}</option>
      {% endfor %}
    </select>
    <input type="number" name="rotation_duration" value="5" min="1" max="1440" style="width: 80px;">
    <span class="hint" style="margin: 0;">min</span>
    <button type="button" class="btn-danger" onclick="this.parentElement.remove()">Remove</button>
  </div>
</template>

<script>
function addRotationEntry() {
  const tmpl = document.getElementById('rotationTemplate');
  const clone = tmpl.content.cloneNode(true);
  document.getElementById('rotationList').appendChild(clone);
}
</script>
{% endblock %}
